---
import BaseLayout from "../layouts/BaseLayout.astro";
const base = import.meta.env.BASE_URL.replace(/\/$/, "");

const photos = [
  { src: `${base}/images/gallery/snouts1.jpg`, alt: "The Snouts band photo" },
  { src: `${base}/images/gallery/snouts2.jpg`, alt: "The Snouts live shot" },
  { src: `${base}/images/gallery/snouts3.jpg`, alt: "The Snouts studio session" },
  { src: `${base}/images/gallery/snouts4.jpg`, alt: "The Snouts behind the scenes" },
  { src: `${base}/images/gallery/snouts5.jpg`, alt: "The Snouts on stage" },
  { src: `${base}/images/gallery/snouts6.jpg`, alt: "The Snouts group portrait" },
];
---

<BaseLayout title="Gallery" description="Photos of The Snouts live, in the studio, and behind the scenes.">
  <section class="container mx-auto px-4 md:pl-10 pt-40 pb-30">
    <h1 class="text-6xl md:text-7xl font-bold">Gallery</h1>
    <p class="mt-2 mb-8 text-brand-muted">Live shots, studio sessions, and behind the scenes.</p>

    <!-- Responsive photo grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {photos.map((photo) => (
        <button
          class="overflow-hidden rounded-lg cursor-pointer group focus:outline-none focus:ring-2 focus:ring-brand-accent"
          data-src={photo.src}
          data-alt={photo.alt}
        >
          <img
            src={photo.src}
            alt={photo.alt}
            class="w-full h-64 object-cover object-[center_15%] transition-transform duration-300 group-hover:scale-105"
            loading="lazy"
          />
        </button>
      ))}
    </div>

    <!-- Lightbox modal -->
    <div
      id="lightbox"
      class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 p-4"
      role="dialog"
      aria-modal="true"
      aria-label="Photo viewer"
    >
      <button
        id="lightbox-close"
        class="absolute top-4 right-4 text-white text-3xl leading-none hover:text-brand-accent focus:outline-none focus:ring-2 focus:ring-brand-accent rounded z-10"
        aria-label="Close photo viewer"
      >&times;</button>

      <!-- Previous button -->
      <button
        id="lightbox-prev"
        class="absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-brand-accent rounded z-10"
        aria-label="Previous photo"
      >
        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <img
        id="lightbox-img"
        class="max-h-[85vh] max-w-full rounded-lg object-contain"
        src=""
        alt=""
      />

      <!-- Next button -->
      <button
        id="lightbox-next"
        class="absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white transition-colors focus:outline-none focus:ring-2 focus:ring-brand-accent rounded z-10"
        aria-label="Next photo"
      >
        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </section>

  <script>
    const galleryButtons = document.querySelectorAll<HTMLButtonElement>("[data-src]");
    const lightbox = document.getElementById("lightbox")!;
    const lightboxClose = document.getElementById("lightbox-close")!;
    const lightboxPrev = document.getElementById("lightbox-prev")!;
    const lightboxNext = document.getElementById("lightbox-next")!;
    const lightboxImg = document.getElementById("lightbox-img") as HTMLImageElement;

    const photos = Array.from(galleryButtons).map((btn) => ({
      src: btn.getAttribute("data-src") ?? "",
      alt: btn.getAttribute("data-alt") ?? "",
    }));
    let currentIndex = 0;

    function showPhoto(index: number) {
      currentIndex = (index + photos.length) % photos.length;
      lightboxImg.src = photos[currentIndex].src;
      lightboxImg.alt = photos[currentIndex].alt;
    }

    function openLightbox(index: number) {
      showPhoto(index);
      lightbox.classList.remove("hidden");
      lightbox.classList.add("flex");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox() {
      lightbox.classList.add("hidden");
      lightbox.classList.remove("flex");
      lightboxImg.src = "";
      document.body.style.overflow = "";
    }

    galleryButtons.forEach((button, i) => {
      button.addEventListener("click", () => openLightbox(i));
    });

    lightboxPrev.addEventListener("click", () => showPhoto(currentIndex - 1));
    lightboxNext.addEventListener("click", () => showPhoto(currentIndex + 1));
    lightboxClose.addEventListener("click", closeLightbox);

    lightbox.addEventListener("click", (event) => {
      if (event.target === lightbox) {
        closeLightbox();
      }
    });

    document.addEventListener("keydown", (event) => {
      if (lightbox.classList.contains("hidden")) return;
      if (event.key === "Escape") closeLightbox();
      if (event.key === "ArrowLeft") showPhoto(currentIndex - 1);
      if (event.key === "ArrowRight") showPhoto(currentIndex + 1);
    });
  </script>
</BaseLayout>
